{% extends "base.html" %}

{% block title %}Trang Chủ{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Featured Post Section -->
        {% if posts.items %}
            {% set featured_post = posts.items[0] %}
            <div class="col-12 mb-5">
                <div class="featured-post">
                    {% if featured_post.image_path %}
                        <img src="{{ url_for('static', filename='uploads/' + featured_post.image_path) }}" alt="{{ featured_post.title }}" class="img-fluid">
                    {% else %}
                        <img src="{{ url_for('static', filename='uploads/default_post.jpg') }}" alt="Default Post Image" class="img-fluid">
                    {% endif %}
                    <div class="overlay">
                        <span class="category-badge">Nổi bật</span>
                        <h2 class="display-5 fw-bold"><a href="{{ url_for('posts.post', post_id=featured_post.id) }}" class="text-white text-decoration-none">{{ featured_post.title }}</a></h2>
                        <div class="d-flex align-items-center text-white-50 mb-3">
                            <img src="{{ url_for('static', filename='uploads/' + featured_post.author.profile_image) }}" 
                                 alt="{{ featured_post.author.username }}" 
                                 class="rounded-circle me-2"
                                 style="width: 32px; height: 32px; object-fit: cover;">
                            <span>{{ featured_post.author.username }}</span>
                            <span class="mx-2">•</span>
                            <span>{{ featured_post.date_posted.strftime('%H:%M Ngày %d-%m-%Y') }}</span>
                        </div>
                        <p class="lead d-none d-md-block">{{ featured_post.content | truncate(200) }}</p>
                        <a href="{{ url_for('posts.post', post_id=featured_post.id) }}" class="btn btn-primary">Đọc thêm</a>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Recent Posts Grid -->
        <div class="col-lg-8">
            <h3 class="mb-4">Bài viết gần đây</h3>
            <div class="row post-grid">
                {% for post in posts.items %}
                    {% if not loop.first %}
                    <div class="col-md-12 mb-3">
                        <a href="{{ url_for('posts.post', post_id=post.id) }}" class="text-decoration-none text-dark">
                            <div class="card h-100 shadow-sm flex-row align-items-stretch">
                                {% if post.image_path %}
                                    <img src="{{ url_for('static', filename='uploads/' + post.image_path) }}" class="card-img-left" alt="{{ post.title }}">
                                {% else %}
                                    <img src="{{ url_for('static', filename='uploads/default_post.jpg') }}" class="card-img-left" alt="Default Post Image">
                                {% endif %}
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <div>
                                        <div class="d-flex align-items-center mb-2">
                                            <img src="{{ url_for('static', filename='uploads/' + post.author.profile_image) }}" alt="{{ post.author.username }}" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
                                            <span class="fw-bold">{{ post.author.username }}</span>
                                        </div>
                                        <h5 class="card-title mb-1">{{ post.title }}</h5>
                                        <p class="card-text mb-1 text-muted small">{{ post.content | truncate(80) }}</p>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-2">
                                        <span class="text-muted small">{{ post.date_posted.strftime('%d-%m-%Y') }}</span>
                                        <span>
                                            <span class="text-danger me-3"><i class="bi bi-heart-fill me-1"></i>{{ post.likes|length }}</span>
                                            <span class="text-primary"><i class="bi bi-chat-dots-fill me-1"></i>{{ post.post_comments|length }}</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    {% if posts.has_prev %}
                    <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=posts.prev_num) }}">Trước</a></li>
                    {% endif %}
                    {% for page_num in posts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                        {% if page_num %}
                            {% if posts.page == page_num %}
                            <li class="page-item active"><a class="page-link" href="#">{{ page_num }}</a></li>
                            {% else %}
                            <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=page_num) }}">{{ page_num }}</a></li>
                            {% endif %}
                        {% else %}
                        <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                        {% endif %}
                    {% endfor %}
                    {% if posts.has_next %}
                    <li class="page-item"><a class="page-link" href="{{ url_for('main.home', page=posts.next_num) }}">Sau</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sidebar-widget mb-4">
                <h4 class="mb-3">Giới thiệu</h4>
                <p class="text-muted">Nơi hội tụ những người đam mê đồng hồ! Khám phá các bài đánh giá chuyên sâu, tin tức mới nhất và các cuộc thảo luận hấp dẫn về mọi thứ liên quan đến đồng hồ.</p>
                <a href="{{ url_for('main.about') }}" class="btn btn-sm btn-outline-primary">Tìm hiểu thêm</a>
            </div>

            <div class="sidebar-widget">
                <h4 class="mb-3">Đăng ký nhận bản tin</h4>
                <p class="text-muted">Nhận những bài viết và tin tức đồng hồ mới nhất ngay vào hộp thư đến của bạn.</p>
                <form class="newsletter-form">
                    <div class="input-group mb-3">
                        <input type="email" class="form-control" placeholder="Nhập email của bạn" aria-label="Nhập email của bạn">
                        <button class="btn btn-primary" type="submit">Đăng ký</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %} 